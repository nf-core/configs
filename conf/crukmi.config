//Profile config names for nf-core/configs
params {
    config_profile_description = 'Cancer Research UK Manchester Institute HPC cluster profile provided by nf-core/configs'
    config_profile_contact     = 'Stephen Kitcatt, Simon Pearce (@skitcattCRUKMI, @sppearce)'
    config_profile_url         = 'http://scicom.picr.man.ac.uk/projects/user-support/wiki'
}

singularity {
    cacheDir   = '/lmod/nextflow_software'
    enabled    = true
    autoMounts = true
}

process {
    resourceLimits = [
        memory: 4000.GB,
        cpus: 96,
        time: 72.h
    ]
    beforeScript   = 'module load apps/apptainer'
    executor       = 'slurm'
    queue          = { task.memory <= 240.GB ? 'compute' : 'hmem' }

    errorStrategy  = { task.exitStatus in [143, 137, 104, 134, 139, 140] ? 'retry' : 'finish' }
    maxErrors      = '-1'
    maxRetries     = 3

    withLabel: process_single {
        cpus   = 1
        memory = 5
    }

    withLabel: process_low {
        cpus   = 1
        memory = 5.GB
    }

    withLabel: process_medium {
        cpus   = 4
        memory = 20.GB
    }

    withLabel: process_high {
        cpus   = 48
        memory = 240.GB
    }
}

executor {
    name         = 'slurm'
    queueSize    = 1000
    pollInterval = '10 sec'
}

params {
    max_memory = 4000.GB
    max_cpus   = 96
    max_time   = 72.h
}
