// farm22 cluster at Wellcome Sanger Institute

params {
    max_memory = 2.9.TB
    max_cpus = 256
    max_time = 43200.min // 30 days
}

process {
    resourceLimits = [
        memory: 2.9.TB,
        cpus: 256,
        time: 43200.min
    ]
}

singularity {
    // Mount all filesystems by default
    runOptions = '--bind /lustre --bind /nfs --bind /data --bind /software'
}

// Currently a single set of rules for all clusters, but we could apply
// different rules to different clusters in their respective configs under ./sanger/
queue = {
    if (task.accelerator) {
        return task.time > 12.h ? 'gpu-huge' : task.time > 48.h ? 'gpu-basement' : 'gpu-normal'
    } else {
        if (task.time >= 15.day) {
            if (task.memory > 680.GB) {
                error "There is no queue for jobs that need >680 GB and >15 days we suggest you use checkpointing"
            } else {
                return "basement"
            }
        } else if (task.memory > 720.GB) {
            return "teramem"
        } else if (task.memory > 350.GB) {
            return "hugemem"
        } else if (task.time > 7.day) {
            return "basement"
        } else if (task.time > 2.day) {
            return "week"
        } else if (task.time > 12.hour) {
            return "long"
        } else if (task.time > 1.min || !task.time) {
            return "normal"
        } else {
            return "small"
        }
    }
}
